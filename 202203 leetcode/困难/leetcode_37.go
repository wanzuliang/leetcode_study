/*
题目描述：  37. 解数独
难度：  简单
编写日期：   2022 年 3 月 11 日 22：20
重写日期：   
*/
/*题目：  
编写一个程序，通过填充空格来解决数独问题。

数独的解法需 遵循如下规则：

数字 1-9 在每一行只能出现一次。
数字 1-9 在每一列只能出现一次。
数字 1-9 在每一个以粗实线分隔的 3x3 宫内只能出现一次。（请参考示例图）
数独部分空格内已填入了数字，空白格用 '.' 表示。

 

来源：力扣（LeetCode）
链接：https://leetcode-cn.com/problems/sudoku-solver
著作权归领扣网络所有。商业转载请联系官方授权，非商业转载请注明出处。

*/
/*  
    数独 逻辑推理析取合取
*/
package main

import (
    "fmt"
)

func main() {
    fmt.Println( "T" )
}


// 默认代码模版   错误版本 
func solveSudoku(board [][]byte)  {
    sum := 0
    block := [3][3]int{}
    line := [9][9]int{}
    column := [9][9]int{}
    for i := 0; i < 9; i++ {
        for j := 0; j < 9; j++ {
            if board[i][j] != '.' {
                sum++
                move := board[i][j] - '1'
                bit := 1 << move
                block[i/3][j/3] |= bit
                for n := 0; n < 9; n++ {
                    line[i][n] |= bit
                    column[n][j] |= bit
                }
                line[i][j] = ^bit
                column[i][j] = ^bit
                // if 0 == block[i/3][j/3] & bit {
                //     block[i/3][j/3] = ^bit
                // }
                // if 0 == line[i] & bit {
                //     line[i][j] += bit
                // }
                // if 0 == column[j] & bit {
                //     column[i][j] += bit
                // }
            }
        }
    }
    
    // fmt.Println( block[1][1] )
    
    // fmt.Println( line[4][4] )
        
    // fmt.Println( column[4][4] )
    // fmt.Println( isOnly(block[1][1], line[4][4], column[4][4]) )
    // fmt.Println( column[1][2] )
    // fmt.Println( column[1][3] )


    for sum < 80 && true {
        for i := 0; i < 9; i++ {
            for j := 0; j < 9; j++ {
                if board[i][j] == '.' {
                    // 排除得到唯一
                    bit := isOnly(block[i/3][j/3], line[i][j], column[i][j])
                    
                    if bit > 0 {
                    // fmt.Println( i, j, bit )
                        sum++
                        board[i][j] = byte(bit + '0')
                        bit = 1 << (bit-1)
                        block[i/3][j/3] |= bit
                        for n := 0; n < 9; n++ {
                            line[i][n] |= bit
                            column[n][j] |= bit
                        }
                        line[i][j] = ^bit
                        column[i][j] = ^bit
                    }
                    //只能填这个数
                    temp :=  0;
                    for m := i/3; m < 3; m++ {
                        for n := j/3; n < 3; n++ {
                            if m != i%3 && n != j%3 {
                            temp |= block[m][n] | line[m][n] | column[m][n]
                            }
                        }
                    }
                    for n := 0; n < 9; n++ {
                        bit := 1 << n
                        if ^temp & 511 == bit {
                            sum++
                            board[i][j] = byte(n + '0')
                            block[i/3][j/3] |= bit
                            for n := 0; n < 9; n++ {
                                line[i][n] |= bit
                                column[n][j] |= bit
                            }
                            line[i][j] = ^bit
                            column[i][j] = ^bit
                        }
                    }
                }
            }
        }
    }
}

func isOnly(block, line, column int) int {
    data := block | line | column
    for n := 0; n < 9; n++ {
        bit := 1 << n
    // fmt.Println( (^data) & 511 )
        if bit == ^data & 511 {
            return n + 1
        }
    }
    return 0
}

board =[
["5","3",".",".","7",".",".",".","."],
["6",".",".","1","9","5",".",".","."],
[".","9","8",".",".",".",".","6","."],
["8",".",".",".","6",".",".",".","3"],
["4",".",".","8",".","3",".",".","1"],
["7",".",".",".","2",".",".",".","6"],
[".","6",".",".",".",".","2","8","."],
[".",".",".","4","1","9",".",".","5"],
[".",".",".",".","8",".",".","7","9"]]
输出：[
["5","3","4","6","7","8","9","1","2"],
["6","7","2","1","9","5","3","4","8"],
["1","9","8","3","4","2","5","6","7"],
["8","5","9","7","6","1","4","2","3"],
["4","2","6","8","5","3","7","9","1"],
["7","1","3","9","2","4","8","5","6"],
["9","6","1","5","3","7","2","8","4"],
["2","8","7","4","1","9","6","3","5"],
["3","4","5","2","8","6","1","7","9"]]


最后执行的输入：
[[".",".","9","7","4","8",".",".","."],["7",".",".",".",".",".",".",".","."],[".","2",".","1",".","9",".",".","."],[".",".","7",".",".",".","2","4","."],[".","6","4",".","1",".","5","9","."],[".","9","8",".",".",".","3",".","."],[".",".",".","8",".","3",".","2","."],[".",".",".",".",".",".",".",".","6"],[".",".",".","2","7","5","9",".","."]]

[[".",".","9","7","4","8",".",".","."]
,["7",".",".","6",".","2",".",".","."]
,[".","2",".","1",".","9",".",".","."]
,[".",".","7","9","8","6","2","4","1"]
,["2","6","4","3","1","7","5","9","8"]
,["1","9","8","5","2","4","3","6","7"]
,[".",".",".","8","6","3",".","2","."]
,[".",".",".","4","9","1",".",".","6"]
,[".",".",".","2","7","5","9",".","."]]

[[".",".","9","7","4","8",".",".","."],["7",".",".","6",".","2",".",".","."],[".","2",".","1",".","9",".",".","."],[".",".","7","9","8","6","2","4","1"],["2","6","4","3","1","7","5","9","8"],["1","9","8","5","2","4","3","6","7"],[".",".",".","8","6","3",".","2","."],[".",".",".","4","9","1",".",".","6"],[".",".",".","2","7","5","9",".","."]]
[[".",".","9","7","4","8",".",".","."],["7",".",".","6",".","2",".",".","."],[".","2",".","1",".","9",".",".","."],[".",".","7","9","8","6","2","4","1"],["2","6","4","3","1","7","5","9","8"],["1","9","8","5","2","4","3","6","7"],[".",".",".","8","6","3",".","2","."],[".",".",".","4","9","1",".",".","6"],[".",".",".","2","7","5","9",".","."]]

1 1110 1111 // 11111 1011 // 00101 0100

[[-17 -5 84 84 -65 84 84 84 84] 
[-33 305 305 -2 -257 -17 305 305 305] 
[416 -257 -129 416 416 416 416 -33 416] 
[-129 164 164 164 -33 164 164 164 -5] 
[-9 141 141 -129 141 -5 141 141 -2] 
[-65 98 98 98 -3 98 98 98 -33] 
[162 -33 162 162 162 162 -3 -129 162]
 [281 281 281 -9 -2 -257 281 281 -17] 
 [448 448 448 448 -129 448 448 -65 -257]]

1 1110 1111 // 01111 1011 // 01000 0000 // 01000 1001
[[-17 -5 128 137 -65 276 2 224 309] 
[-33 292 128 -2 -257 -17 2 224 309] 
[248 -257 -129 137 483 276 2 -33 309] 
[-129 292 128 137 -33 276 2 224 -5] 
[-9 292 128 -129 483 -5 2 224 -2] 
[-65 292 128 137 -3 276 2 224 -33] 
[248 -33 128 137 483 276 -3 -129 309] 
[248 292 128 -9 -2 -257 2 224 -17] 
[248 292 128 137 -129 276 2 -65 -257]]
